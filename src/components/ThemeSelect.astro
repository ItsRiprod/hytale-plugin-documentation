---
/**
 * Custom ThemeSelect component that extends Starlight's default with
 * multiple accent color themes (Blue, Emerald, Amber, Purple) each
 * with dark and light variants.
 */
---

<starlight-theme-select>
	<label>
		<span class="sr-only">Select theme</span>
		<select>
			<optgroup label="Blue (Default)">
				<option value="dark">Blue Dark</option>
				<option value="light">Blue Light</option>
			</optgroup>
			<optgroup label="Emerald">
				<option value="emerald">Emerald Dark</option>
				<option value="emerald-light">Emerald Light</option>
			</optgroup>
			<optgroup label="Amber">
				<option value="amber">Amber Dark</option>
				<option value="amber-light">Amber Light</option>
			</optgroup>
			<optgroup label="Purple">
				<option value="purple">Purple Dark</option>
				<option value="purple-light">Purple Light</option>
			</optgroup>
		</select>
		<svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
			<path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
		</svg>
	</label>
</starlight-theme-select>

<script>
	type Theme = 'dark' | 'light' | 'emerald' | 'emerald-light' | 'amber' | 'amber-light' | 'purple' | 'purple-light';

	class StarlightThemeSelect extends HTMLElement {
		#select: HTMLSelectElement | null = null;
		#STORAGE_KEY = 'starlight-theme';

		constructor() {
			super();
			this.#select = this.querySelector('select');

			// Initialize on construction
			this.#initTheme();

			// Listen for changes
			this.#select?.addEventListener('change', () => {
				const theme = this.#select?.value as Theme;
				this.#setTheme(theme);
			});
		}

		#initTheme() {
			const stored = this.#getStoredTheme();
			const theme = stored || this.#getPreferredTheme();

			// Set the select value
			if (this.#select) {
				this.#select.value = theme;
			}

			// Apply theme
			this.#applyTheme(theme);
		}

		#getStoredTheme(): Theme | null {
			if (typeof localStorage === 'undefined') return null;
			const stored = localStorage.getItem(this.#STORAGE_KEY);
			if (this.#isValidTheme(stored)) {
				return stored as Theme;
			}
			return null;
		}

		#getPreferredTheme(): Theme {
			// Check system preference for dark/light
			if (typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: light)').matches) {
				return 'light';
			}
			return 'dark';
		}

		#isValidTheme(theme: string | null): boolean {
			return ['dark', 'light', 'emerald', 'emerald-light', 'amber', 'amber-light', 'purple', 'purple-light'].includes(theme || '');
		}

		#setTheme(theme: Theme) {
			// Store preference
			if (typeof localStorage !== 'undefined') {
				localStorage.setItem(this.#STORAGE_KEY, theme);
			}

			// Apply theme
			this.#applyTheme(theme);
		}

		#applyTheme(theme: Theme) {
			document.documentElement.setAttribute('data-theme', theme);
		}
	}

	customElements.define('starlight-theme-select', StarlightThemeSelect);
</script>

<style>
	starlight-theme-select {
		display: flex;
		align-items: center;
	}

	label {
		position: relative;
		display: flex;
		align-items: center;
		color: var(--sl-color-gray-2);
	}

	select {
		appearance: none;
		background: transparent;
		border: 1px solid var(--sl-color-hairline);
		border-radius: 0.5rem;
		color: var(--sl-color-gray-2);
		cursor: pointer;
		font-family: inherit;
		font-size: var(--sl-text-sm);
		padding: 0.5rem 2rem 0.5rem 0.75rem;
		transition: all 0.15s ease;
	}

	select:hover {
		border-color: var(--sl-color-accent);
		color: var(--sl-color-white);
	}

	select:focus {
		outline: 2px solid var(--sl-color-accent);
		outline-offset: 2px;
	}

	option {
		background: var(--sl-color-bg-nav);
		color: var(--sl-color-white);
	}

	optgroup {
		background: var(--sl-color-bg);
		color: var(--sl-color-gray-3);
		font-weight: 600;
	}

	svg {
		position: absolute;
		right: 0.5rem;
		pointer-events: none;
		color: var(--sl-color-gray-4);
	}

	/* Screen reader only class */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
</style>
